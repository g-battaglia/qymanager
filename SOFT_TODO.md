- [ ] [Fix `_get_time_signature()` in `qyconv/analysis/q7p_analyzer.py:349-355`]. PROBLEMA: Il parsing del byte 0x18A usa shift errato: `(ts_byte >> 4) & 0x0F` per numeratore e `1 << (ts_byte & 0x0F)` per denominatore. Con valore 0x1C (28) produce 1/4096 invece di 4/4. L'encoding Yamaha non segue questo schema. IMPATTO: L'utente vede time signature completamente sbagliata nell'output CLI, rendendo impossibile capire il ritmo del pattern. Compromette l'affidabilità dello strumento per musicisti. FIX: Analizzare più file Q7P con time signature note (3/4, 6/8, 4/4) per reverse-engineerare l'encoding corretto. Probabile lookup table o encoding diverso (es. byte separati per num/denom, o indice in tabella predefinita). RISULTATO ATTESO: Time signature mostra correttamente "4/4", "3/4", "6/8" etc. basandosi sul valore raw del byte 0x18A.

- [ ] [Fix `pan_to_string()` in `cli/display/tables.py:23-30`]. PROBLEMA: La funzione assume che pan=0 significhi "L64" (tutto a sinistra), ma nel formato Q7P il valore 0x00 significa "non impostato" o "usa default". Il valore 0x40 (64) rappresenta il centro. Range corretto: 1-127 con 64=center. IMPATTO: Tutti i pan vengono mostrati come "L64" quando non sono configurati, confondendo l'utente che pensa siano tutti pannati a sinistra invece che centrati o non impostati. FIX: Modificare la logica: se `pan == 0` return "---" (non impostato), altrimenti usare la formula esistente. Aggiungere costante `PAN_NOT_SET = 0` e `PAN_CENTER = 64`. RISULTATO ATTESO: Pan=0 mostra "---", Pan=64 mostra "C", Pan=1 mostra "L63", Pan=127 mostra "R63".

- [ ] [Fix `_get_channels()` in `qyconv/analysis/q7p_analyzer.py:357-364`]. PROBLEMA: I valori raw 0x00 e 0x03 vengono mostrati direttamente, ma probabilmente sono offset o indici. Nel QY700 le tracce RHY1/RHY2 usano canale 10 (drums), valori 0x00 potrebbero significare "canale 10" o "canale default per tipo traccia". IMPATTO: I canali MIDI mostrati sono sbagliati (0, 3 invece di 10, 11, etc.), rendendo impossibile capire la configurazione MIDI reale del pattern. FIX: Testare con QY700 reale: creare pattern con canali noti, salvare, confrontare hex. Probabile formula: `channel = raw_value + 10` per drums, o lookup per tipo traccia. Verificare offset 0x190-0x197. RISULTATO ATTESO: RHY1/RHY2 mostrano canale 10, BASS mostra canale corretto, CHD1-5 mostrano canali assegnati.

- [ ] [Find Program Change offset in `qyconv/analysis/q7p_analyzer.py`]. PROBLEMA: Il campo `TrackInfo.program` esiste nel dataclass (linea 28) ma è sempre 0 perché l'offset nel file Q7P non è stato identificato. L'analyzer non estrae quale strumento/voice è assegnato a ogni traccia. IMPATTO: L'utente non può vedere quale strumento suona ogni traccia (es. "Piano", "Bass", "Drums"). Informazione fondamentale per capire il pattern. Rende lo strumento molto meno utile. FIX: Confrontare hex dump di file Q7P con program change diversi. Cercare nell'area 0x2C0-0x35F (TABLE_3) o nella section data 0x120-0x17F. Aggiungere metodo `_get_programs()` simile a `_get_volumes()`. RISULTATO ATTESO: Ogni traccia mostra Program Change 0-127, es. "Prg: 33" per Finger Bass.

- [ ] [Find Bank Select MSB/LSB offset in `qyconv/analysis/q7p_analyzer.py`]. PROBLEMA: I campi `TrackInfo.bank_msb` e `bank_lsb` esistono (linee 29-30) ma sono sempre 0. Senza bank select, non si può distinguere tra voci GM, XG, o user. I synth Yamaha usano Bank MSB=0 per GM, MSB=64+ per XG. IMPATTO: Non si può identificare se una traccia usa Standard Kit (Bank 127,0) vs Power Kit (Bank 127,1) o quale voce XG specifica. Limita analisi pattern XG complessi. FIX: Bank Select solitamente vicino a Program Change. Cercare pattern 0x00/0x7F (MSB) seguito da 0x00-0x7F (LSB) nell'area track config. Probabile offset 0x2C0+ area. RISULTATO ATTESO: Tracce mostrano "Bank: 0/0" per GM, "Bank: 127/0" per Standard Kit drums.

- [ ] [Find Reverb/Chorus Send offset in `qyconv/analysis/q7p_analyzer.py`]. PROBLEMA: I campi `reverb_send` e `chorus_send` esistono in TrackSettings model (`qyconv/models/track.py:33-34`) ma Q7PAnalyzer non li estrae. Send levels sono CC#91 e CC#93, valori 0-127. IMPATTO: Non si può vedere il mix effetti del pattern. Utile per capire quanto "wet" è il suono, importante per la produzione musicale e per replicare lo stile. FIX: Cercare 8 bytes consecutivi con valori tipici (0x28=40 default reverb, 0x00 default chorus) nell'area 0x270-0x2BF o 0x2C0-0x35F. Aggiungere `_get_reverb_sends()` e `_get_chorus_sends()`. RISULTATO ATTESO: Ogni traccia mostra "Rev: 40, Cho: 0" o valori effettivi configurati.

- [ ] [Extract Transpose/Velocity/GateTime in `qyconv/analysis/q7p_analyzer.py:420-448`]. PROBLEMA: Il metodo `_analyze_section_tracks()` crea TrackInfo ma lascia `transpose=0`, `velocity_offset=0`, `gate_time=100` hardcoded. Questi parametri esistono nel file ma offset non identificati. IMPATTO: Non si vedono le modifiche di trasposizione, dinamica e articolazione delle tracce. Importante per capire come il pattern è stato ottimizzato per suonare bene. FIX: Transpose tipicamente signed byte (-24 to +24), velocity offset signed (-64 to +63), gate time 1-200%. Cercare nell'area 0x1A0-0x1DB (RESERVED_1) o track config 0x1DC-0x1FF. RISULTATO ATTESO: Tracce mostrano "Trans: +2", "Vel: -10", "Gate: 80%" quando configurati.

- [ ] [Calculate real section length in `qyconv/analysis/q7p_analyzer.py:400-411`]. PROBLEMA: `SectionInfo.length_measures` è hardcoded a 4 (linea 406). La lunghezza reale della sezione (in battute) deve essere estratta dal file, probabilmente nella section config data o nei pointers. IMPATTO: Tutte le sezioni mostrano "4 measures" anche se sono 2, 8, o 16 battute. Informazione errata sulla struttura del pattern. FIX: Analizzare section config data (16 bytes per sezione a partire da 0x120). Probabile che lunghezza sia in uno dei primi bytes. Confrontare pattern con lunghezze note diverse. RISULTATO ATTESO: Sezioni mostrano lunghezza reale "2 bars", "4 bars", "8 bars" basata sui dati del file.

- [ ] [Add GM instrument lookup table in `qyconv/utils/gm_instruments.py` (new file)]. PROBLEMA: Non esiste una lookup table per convertire Program Change number (0-127) in nome strumento leggibile. L'utente vede solo "Program: 33" invece di "Program: 33 (Finger Bass)". IMPATTO: L'utente deve consultare tabella GM esterna per capire quale strumento è assegnato. Riduce usabilità significativamente, specialmente per utenti non esperti MIDI. FIX: Creare file `gm_instruments.py` con lista GM_INSTRUMENTS[128] = ["Acoustic Grand Piano", "Bright Acoustic Piano", ...]. Aggiungere funzione `get_instrument_name(program: int, bank_msb: int = 0) -> str`. RISULTATO ATTESO: Output CLI mostra "Prg: 33 Finger Bass" invece di solo "Prg: 33".

- [ ] [Add Voice Settings table in `cli/display/tables.py`]. PROBLEMA: Il display Q7P mostra solo Channel/Volume/Pan ma manca una tabella dedicata per Voice Settings con Program Change, Bank Select, e nome strumento. Informazioni disperse o mancanti. IMPATTO: L'utente non ha una vista chiara delle voci assegnate. Deve guardare raw hex per capire gli strumenti. Esperienza utente incompleta per analisi pattern. FIX: Aggiungere funzione `display_voice_settings_table(analysis)` che crea Rich Table con colonne: Track, Channel, Bank MSB/LSB, Program, Instrument Name. Chiamarla da `display_q7p_info()`. RISULTATO ATTESO: Nuova tabella "Voice Settings" mostra configurazione completa strumenti per ogni traccia.

- [ ] [Add Effects table in `cli/display/tables.py`]. PROBLEMA: Non esiste visualizzazione per Reverb Send, Chorus Send, Variation Send levels. Questi parametri definiscono il "suono" del mix ma sono invisibili nell'output corrente. IMPATTO: L'utente non può analizzare il mix effetti del pattern. Importante per sound design e per replicare lo stile su altri synth. Funzionalità attesa da un analyzer professionale. FIX: Aggiungere funzione `display_effects_table(analysis)` con Rich Table: Track, Reverb, Chorus, Variation (quando offset trovati). Mostrare valori 0-127 e percentuale. RISULTATO ATTESO: Nuova tabella "Effects Send" mostra Rev/Cho/Var per ogni traccia con valori numerici.

- [ ] [Parse MIDI events from phrase data in `qyconv/analysis/q7p_analyzer.py`]. PROBLEMA: L'area phrase data (0x360-0x677, 792 bytes) contiene eventi MIDI ma non esiste parser. Il campo `phrase_area_raw` viene estratto ma mai interpretato. Solo hex dump disponibile. IMPATTO: Non si può analizzare il contenuto musicale effettivo: quali note, quando, con quale velocity. Limita l'utilità a sola analisi strutturale, non musicale. FIX: Creare classe `PhraseParser` che interpreta il formato eventi (probabilmente: delta-time + status + data1 + data2). Identificare marker inizio/fine frase. Aggiungere a Q7PAnalysis lista di eventi parsed. RISULTATO ATTESO: Analisi mostra "Section has 45 note events, range C2-G4, avg velocity 80".

- [ ] [Calculate phrase statistics in `qyconv/analysis/q7p_analyzer.py`]. PROBLEMA: Nessuna statistica sulle phrase: numero eventi, range note (min-max), velocity media, densità. Solo `data_density` calcolata su tutto il file, non per sezione. IMPATTO: L'utente non può valutare complessità e caratteristiche musicali delle sezioni. Utile per confrontare pattern o identificare sezioni vuote vs piene. FIX: Dopo aver implementato phrase parser, aggiungere a SectionInfo: `event_count`, `note_range: Tuple[int,int]`, `avg_velocity`, `note_density`. Calcolare in `_analyze_sections()`. RISULTATO ATTESO: Ogni sezione mostra "Events: 48, Notes: C2-G4, Vel avg: 85, Density: 12 evt/bar".

- [ ] [Add phrase preview to CLI in `cli/display/tables.py`]. PROBLEMA: Il comando `info` non mostra preview dei dati phrase. L'utente deve usare `--hex` per vedere raw data, ma non è interpretato. Nessun summary delle note contenute. IMPATTO: L'analisi pattern è "cieca" al contenuto musicale. L'utente sa che c'è una sezione Intro ma non cosa contiene. Riduce utilità pratica dello strumento. FIX: Aggiungere sezione "Phrase Summary" a `display_q7p_info()` che mostra per ogni sezione attiva: numero eventi, range note, preview primi eventi. Dipende da phrase parser. RISULTATO ATTESO: Output CLI include "Phrase Data" panel con summary statistiche per sezione.

- [ ] [Add `analyze` command in `cli/commands/analyze.py` (new file)]. PROBLEMA: Non esiste comando per analisi MIDI dettagliata. Il comando `info` mostra solo struttura file, non contenuto musicale. Manca deep-dive negli eventi. IMPATTO: Per analisi approfondita l'utente deve esportare a MIDI e usare altro software. Workflow spezzato, perdita di tempo. Lo strumento è incompleto per reverse engineering. FIX: Creare `cli/commands/analyze.py` con comando Typer che chiama phrase parser. Options: `--events` (lista eventi), `--stats` (statistiche), `--section N` (filtra sezione). Registrare in app.py. RISULTATO ATTESO: `qyconv analyze pattern.Q7P --events` mostra lista eventi MIDI con timing, note, velocity.

- [ ] [Add piano-roll ASCII visualization in `cli/display/piano_roll.py` (new file)]. PROBLEMA: Non esiste visualizzazione grafica ASCII delle note. Altri tool MIDI (come `mid2txt`) offrono questa feature. Utile per quick visual inspection del pattern. IMPATTO: L'utente non può "vedere" la musica senza aprire un DAW. Riduce velocità di analisi e comprensione del pattern. Feature attesa da power users. FIX: Creare `piano_roll.py` con funzione che genera grid ASCII: righe=note (C2-C5), colonne=beat. Simboli: `#`=note, `.`=silence. Larghezza configurabile. Integrare con `analyze --piano-roll`. RISULTATO ATTESO: Output ASCII tipo "C4: #.#.#...|........" che visualizza pattern ritmico.

- [ ] [Add `diff` command in `cli/commands/diff.py` (new file)]. PROBLEMA: Non esiste modo di confrontare due pattern side-by-side. Utile per vedere differenze tra versioni o tra QY70 e QY700 dopo conversione. IMPATTO: L'utente deve confrontare manualmente due output `info`. Tedioso e error-prone. Non può verificare facilmente che conversione abbia preservato dati. FIX: Creare comando `diff` che accetta due file, analizza entrambi, mostra tabella differenze: campi che differiscono evidenziati in rosso/verde. Usare Rich columns per side-by-side. RISULTATO ATTESO: `qyconv diff a.Q7P b.Q7P` mostra tabella con differenze highlight tipo git diff.

- [ ] [Add `validate` command in `cli/commands/validate.py` (new file)]. PROBLEMA: Non esiste validazione strutturale completa. `Pattern.validate()` esiste nel model ma non è esposto via CLI. Non verifica integrità checksum, range valori, struttura file. IMPATTO: L'utente non può verificare se un file Q7P è corrotto o malformato prima di caricarlo sul QY700. Rischio di crash o comportamento errato sul synth hardware. FIX: Creare comando `validate` che esegue: check header magic, file size, section pointers validity, value ranges (tempo 40-240, volume 0-127, etc.), checksum se applicabile. Report errori/warnings. RISULTATO ATTESO: `qyconv validate pattern.Q7P` mostra "Valid" o lista di problemi trovati con severity.

- [ ] [Add `export` command for MIDI export in `cli/commands/export.py` (new file)]. PROBLEMA: Non esiste export a Standard MIDI File (.mid). L'utente non può usare i pattern in DAW o altri software musicali. Formato Q7P è proprietario e chiuso. IMPATTO: I pattern sono "intrappolati" nel formato Yamaha. Non interoperabili con ecosistema musicale moderno. Limita utilità dello strumento per produzione musicale. FIX: Creare comando `export` che usa libreria `mido` per generare SMF Type 1. Mappare sezioni a tracce MIDI, includere tempo, time signature, program change, note events. Option per sezione singola o tutte. RISULTATO ATTESO: `qyconv export pattern.Q7P -o pattern.mid` crea file MIDI apribile in qualsiasi DAW.
