- [x] [RISOLTO] [Fix `_get_time_signature()` in `qymanager/analysis/q7p_analyzer.py`]. Risolto con lookup table `TIME_SIGNATURE_MAP`. 0x1C = 4/4 confermato. Ipotesi per altri valori (3/4, 6/8 etc.) da verificare con hardware.

- [x] [RISOLTO] [Fix `pan_to_string()` in `cli/display/tables.py`]. Pan=0 ora mostra "Rnd" (XG Random). Pan display nel SysEx track table usa `pan_to_string()` condiviso. Pan=64="C", Pan<64="L{n}", Pan>64="R{n}".

- [x] [RISOLTO] [Fix `_get_channels()` in `qymanager/analysis/q7p_analyzer.py`]. Valori 0x00, 0x03, 0x20 sono group markers, non canali MIDI. Ora vengono mappati a DEFAULT_CHANNELS per posizione traccia. TR1/TR2=Ch10, TR3=Ch2, TR4=Ch3, TR5-TR12=Ch4-Ch12.

- [x] [RISOLTO] [Fix AL addressing in SysEx codebase]. Schema AL era SBAGLIATO: usava AL=0x08+section*8+track con "phrase data" a 0x00-0x05. Corretto: AL=section*8+track (confermato da SGT reference dump). NON esiste regione phrase data separata. Fix applicato in 6 file: syx_analyzer.py, qy700_to_qy70.py, qy70_to_qy700.py, reader.py, writer.py, info.py.

- [x] [RISOLTO] [Fix D1 voice regression in `qymanager/analysis/syx_analyzer.py`]. Messaggi Init/Close (PARAMETER_CHANGE addr 00/00/00) condividevano AL=0x00 con Section 0 Track 0, iniettando 2 byte spuri. Fix: solo messaggi style data (AH=0x02, AM=0x7E) vengono accumulati per AL. Bonus: checksum count ora corretto.

- [x] [RISOLTO] [Fix reader.py/writer.py AL addressing]. reader.py: SECTION_MAP ora usa indici 0-5, _parse_section raccoglie 8 tracce per sezione con AL corretto. writer.py: _write_section scrive ogni traccia al suo AL=section_idx*8+track_idx.

- [x] [RISOLTO] [Fix checksum in `qymanager/formats/qy70/writer.py`]. Checksum calcolato su `AH AM AL + data` (3 bytes) — SBAGLIATO. Corretto a `BH BL AH AM AL + data` (5 bytes). Confermato dal SGT reference dump. `verify_sysex_checksum()` era già corretto.

- [x] [RISOLTO] [Fix header generation in `qymanager/converters/qy700_to_qy70.py`]. Header[0] veniva riempito con nome pattern — SBAGLIATO: byte 0 = tempo offset. Tempo scritto come singolo byte a 0x0A — SBAGLIATO: usa formula range/offset. Corretto: decoded[0]=offset, MSBs di decoded[4:7] controllano range byte.

- [x] [RISOLTO] [Fix volume extraction in `qymanager/converters/qy70_to_qy700.py`]. Volume leggeva `track_data[24]` = inizio MIDI events, non volume. Rimosso (offset nel header QY70 non ancora mappato). Tempo extraction riscritta con formula corretta. AL range check corretto: 0x00-0x2F sono tutti track data.

- [x] [RISOLTO] [Fix docstring in `qymanager/converters/qy700_to_qy70.py`]. Docstring diceva "QY70 e QY700 usano lo STESSO formato eventi" — SBAGLIATO. Confermato che usano formati DIVERSI (packed bitstream vs byte commands). Aggiornato con warning.

- [x] [CONFERMATO] [Analisi definitiva formato eventi QY70]. Parser esaustivo (`midi_tools/parse_events.py`) testa command set Q7P su tutti i track data QY70: 16.8% coverage = FALLIMENTO. QY70 usa packed bitstream proprietario: 117 valori high-bit unici, entropy 4.8-6.65 bits/byte, bit frequency uniforme 37-53%. Formato NON decodificabile con approccio byte-oriented.

- [ ] [Decode QY70 packed event format (bytes 24+ in track data)]. Il formato eventi traccia QY70 è un **packed bitstream proprietario** (confermato 2026-02-27). Richiede analisi a livello di BIT, non di byte. Prossimi passi: 1) Analisi bit-level dei dati, 2) Pattern controllati sul QY70 reale (singola nota kick), 3) Confronto multipli file .syx con differenze musicali note.

- [ ] [Find Program Change offset in `qymanager/analysis/q7p_analyzer.py`]. PROBLEMA: Il campo `TrackInfo.program` esiste nel dataclass (linea 28) ma è sempre 0 perché l'offset nel file Q7P non è stato identificato. L'analyzer non estrae quale strumento/voice è assegnato a ogni traccia. IMPATTO: L'utente non può vedere quale strumento suona ogni traccia (es. "Piano", "Bass", "Drums"). Informazione fondamentale per capire il pattern. Rende lo strumento molto meno utile. FIX: Confrontare hex dump di file Q7P con program change diversi. Cercare nell'area 0x2C0-0x35F (TABLE_3) o nella section data 0x120-0x17F. Aggiungere metodo `_get_programs()` simile a `_get_volumes()`. RISULTATO ATTESO: Ogni traccia mostra Program Change 0-127, es. "Prg: 33" per Finger Bass.

- [ ] [Find Bank Select MSB/LSB offset in `qymanager/analysis/q7p_analyzer.py`]. PROBLEMA: I campi `TrackInfo.bank_msb` e `bank_lsb` esistono (linee 29-30) ma sono sempre 0. Senza bank select, non si può distinguere tra voci GM, XG, o user. I synth Yamaha usano Bank MSB=0 per GM, MSB=64+ per XG. IMPATTO: Non si può identificare se una traccia usa Standard Kit (Bank 127,0) vs Power Kit (Bank 127,1) o quale voce XG specifica. Limita analisi pattern XG complessi. FIX: Bank Select solitamente vicino a Program Change. Cercare pattern 0x00/0x7F (MSB) seguito da 0x00-0x7F (LSB) nell'area track config. Probabile offset 0x2C0+ area. RISULTATO ATTESO: Tracce mostrano "Bank: 0/0" per GM, "Bank: 127/0" per Standard Kit drums.

- [ ] [Find Reverb/Chorus Send offset in `qymanager/analysis/q7p_analyzer.py`]. PROBLEMA: I campi `reverb_send` e `chorus_send` esistono in TrackSettings model (`qymanager/models/track.py:33-34`) ma Q7PAnalyzer non li estrae. Send levels sono CC#91 e CC#93, valori 0-127. IMPATTO: Non si può vedere il mix effetti del pattern. Utile per capire quanto "wet" è il suono, importante per la produzione musicale e per replicare lo stile. FIX: Cercare 8 bytes consecutivi con valori tipici (0x28=40 default reverb, 0x00 default chorus) nell'area 0x270-0x2BF o 0x2C0-0x35F. Aggiungere `_get_reverb_sends()` e `_get_chorus_sends()`. RISULTATO ATTESO: Ogni traccia mostra "Rev: 40, Cho: 0" o valori effettivi configurati.

- [ ] [Extract Transpose/Velocity/GateTime in `qymanager/analysis/q7p_analyzer.py:420-448`]. PROBLEMA: Il metodo `_analyze_section_tracks()` crea TrackInfo ma lascia `transpose=0`, `velocity_offset=0`, `gate_time=100` hardcoded. Questi parametri esistono nel file ma offset non identificati. IMPATTO: Non si vedono le modifiche di trasposizione, dinamica e articolazione delle tracce. Importante per capire come il pattern è stato ottimizzato per suonare bene. FIX: Transpose tipicamente signed byte (-24 to +24), velocity offset signed (-64 to +63), gate time 1-200%. Cercare nell'area 0x1A0-0x1DB (RESERVED_1) o track config 0x1DC-0x1FF. RISULTATO ATTESO: Tracce mostrano "Trans: +2", "Vel: -10", "Gate: 80%" quando configurati.

- [ ] [Calculate real section length in `qymanager/analysis/q7p_analyzer.py:400-411`]. PROBLEMA: `SectionInfo.length_measures` è hardcoded a 4 (linea 406). La lunghezza reale della sezione (in battute) deve essere estratta dal file, probabilmente nella section config data o nei pointers. IMPATTO: Tutte le sezioni mostrano "4 measures" anche se sono 2, 8, o 16 battute. Informazione errata sulla struttura del pattern. FIX: Analizzare section config data (16 bytes per sezione a partire da 0x120). Probabile che lunghezza sia in uno dei primi bytes. Confrontare pattern con lunghezze note diverse. RISULTATO ATTESO: Sezioni mostrano lunghezza reale "2 bars", "4 bars", "8 bars" basata sui dati del file.

- [ ] [Add GM instrument lookup table in `qymanager/utils/gm_instruments.py` (new file)]. PROBLEMA: Non esiste una lookup table per convertire Program Change number (0-127) in nome strumento leggibile. L'utente vede solo "Program: 33" invece di "Program: 33 (Finger Bass)". IMPATTO: L'utente deve consultare tabella GM esterna per capire quale strumento è assegnato. Riduce usabilità significativamente, specialmente per utenti non esperti MIDI. FIX: Creare file `gm_instruments.py` con lista GM_INSTRUMENTS[128] = ["Acoustic Grand Piano", "Bright Acoustic Piano", ...]. Aggiungere funzione `get_instrument_name(program: int, bank_msb: int = 0) -> str`. RISULTATO ATTESO: Output CLI mostra "Prg: 33 Finger Bass" invece di solo "Prg: 33".

- [ ] [Add Voice Settings table in `cli/display/tables.py`]. PROBLEMA: Il display Q7P mostra solo Channel/Volume/Pan ma manca una tabella dedicata per Voice Settings con Program Change, Bank Select, e nome strumento. Informazioni disperse o mancanti. IMPATTO: L'utente non ha una vista chiara delle voci assegnate. Deve guardare raw hex per capire gli strumenti. Esperienza utente incompleta per analisi pattern. FIX: Aggiungere funzione `display_voice_settings_table(analysis)` che crea Rich Table con colonne: Track, Channel, Bank MSB/LSB, Program, Instrument Name. Chiamarla da `display_q7p_info()`. RISULTATO ATTESO: Nuova tabella "Voice Settings" mostra configurazione completa strumenti per ogni traccia.

- [ ] [Add Effects table in `cli/display/tables.py`]. PROBLEMA: Non esiste visualizzazione per Reverb Send, Chorus Send, Variation Send levels. Questi parametri definiscono il "suono" del mix ma sono invisibili nell'output corrente. IMPATTO: L'utente non può analizzare il mix effetti del pattern. Importante per sound design e per replicare lo stile su altri synth. Funzionalità attesa da un analyzer professionale. FIX: Aggiungere funzione `display_effects_table(analysis)` con Rich Table: Track, Reverb, Chorus, Variation (quando offset trovati). Mostrare valori 0-127 e percentuale. RISULTATO ATTESO: Nuova tabella "Effects Send" mostra Rev/Cho/Var per ogni traccia con valori numerici.

- [ ] [Parse MIDI events from phrase data in `qymanager/analysis/q7p_analyzer.py`]. PROBLEMA: L'area phrase data (0x360-0x677, 792 bytes) contiene eventi MIDI ma non esiste parser. Il campo `phrase_area_raw` viene estratto ma mai interpretato. Solo hex dump disponibile. IMPATTO: Non si può analizzare il contenuto musicale effettivo: quali note, quando, con quale velocity. Limita l'utilità a sola analisi strutturale, non musicale. FIX: Creare classe `PhraseParser` che interpreta il formato eventi (probabilmente: delta-time + status + data1 + data2). Identificare marker inizio/fine frase. Aggiungere a Q7PAnalysis lista di eventi parsed. RISULTATO ATTESO: Analisi mostra "Section has 45 note events, range C2-G4, avg velocity 80".

- [ ] [Calculate phrase statistics in `qymanager/analysis/q7p_analyzer.py`]. PROBLEMA: Nessuna statistica sulle phrase: numero eventi, range note (min-max), velocity media, densità. Solo `data_density` calcolata su tutto il file, non per sezione. IMPATTO: L'utente non può valutare complessità e caratteristiche musicali delle sezioni. Utile per confrontare pattern o identificare sezioni vuote vs piene. FIX: Dopo aver implementato phrase parser, aggiungere a SectionInfo: `event_count`, `note_range: Tuple[int,int]`, `avg_velocity`, `note_density`. Calcolare in `_analyze_sections()`. RISULTATO ATTESO: Ogni sezione mostra "Events: 48, Notes: C2-G4, Vel avg: 85, Density: 12 evt/bar".

- [ ] [Add phrase preview to CLI in `cli/display/tables.py`]. PROBLEMA: Il comando `info` non mostra preview dei dati phrase. L'utente deve usare `--hex` per vedere raw data, ma non è interpretato. Nessun summary delle note contenute. IMPATTO: L'analisi pattern è "cieca" al contenuto musicale. L'utente sa che c'è una sezione Intro ma non cosa contiene. Riduce utilità pratica dello strumento. FIX: Aggiungere sezione "Phrase Summary" a `display_q7p_info()` che mostra per ogni sezione attiva: numero eventi, range note, preview primi eventi. Dipende da phrase parser. RISULTATO ATTESO: Output CLI include "Phrase Data" panel con summary statistiche per sezione.

- [ ] [Add `analyze` command in `cli/commands/analyze.py` (new file)]. PROBLEMA: Non esiste comando per analisi MIDI dettagliata. Il comando `info` mostra solo struttura file, non contenuto musicale. Manca deep-dive negli eventi. IMPATTO: Per analisi approfondita l'utente deve esportare a MIDI e usare altro software. Workflow spezzato, perdita di tempo. Lo strumento è incompleto per reverse engineering. FIX: Creare `cli/commands/analyze.py` con comando Typer che chiama phrase parser. Options: `--events` (lista eventi), `--stats` (statistiche), `--section N` (filtra sezione). Registrare in app.py. RISULTATO ATTESO: `qymanager analyze pattern.Q7P --events` mostra lista eventi MIDI con timing, note, velocity.

- [ ] [Add piano-roll ASCII visualization in `cli/display/piano_roll.py` (new file)]. PROBLEMA: Non esiste visualizzazione grafica ASCII delle note. Altri tool MIDI (come `mid2txt`) offrono questa feature. Utile per quick visual inspection del pattern. IMPATTO: L'utente non può "vedere" la musica senza aprire un DAW. Riduce velocità di analisi e comprensione del pattern. Feature attesa da power users. FIX: Creare `piano_roll.py` con funzione che genera grid ASCII: righe=note (C2-C5), colonne=beat. Simboli: `#`=note, `.`=silence. Larghezza configurabile. Integrare con `analyze --piano-roll`. RISULTATO ATTESO: Output ASCII tipo "C4: #.#.#...|........" che visualizza pattern ritmico.

- [ ] [Add `diff` command in `cli/commands/diff.py` (new file)]. PROBLEMA: Non esiste modo di confrontare due pattern side-by-side. Utile per vedere differenze tra versioni o tra QY70 e QY700 dopo conversione. IMPATTO: L'utente deve confrontare manualmente due output `info`. Tedioso e error-prone. Non può verificare facilmente che conversione abbia preservato dati. FIX: Creare comando `diff` che accetta due file, analizza entrambi, mostra tabella differenze: campi che differiscono evidenziati in rosso/verde. Usare Rich columns per side-by-side. RISULTATO ATTESO: `qymanager diff a.Q7P b.Q7P` mostra tabella con differenze highlight tipo git diff.

- [ ] [Add `validate` command in `cli/commands/validate.py` (new file)]. PROBLEMA: Non esiste validazione strutturale completa. `Pattern.validate()` esiste nel model ma non è esposto via CLI. Non verifica integrità checksum, range valori, struttura file. IMPATTO: L'utente non può verificare se un file Q7P è corrotto o malformato prima di caricarlo sul QY700. Rischio di crash o comportamento errato sul synth hardware. FIX: Creare comando `validate` che esegue: check header magic, file size, section pointers validity, value ranges (tempo 40-240, volume 0-127, etc.), checksum se applicabile. Report errori/warnings. RISULTATO ATTESO: `qymanager validate pattern.Q7P` mostra "Valid" o lista di problemi trovati con severity.

- [ ] [Add `export` command for MIDI export in `cli/commands/export.py` (new file)]. PROBLEMA: Non esiste export a Standard MIDI File (.mid). L'utente non può usare i pattern in DAW o altri software musicali. Formato Q7P è proprietario e chiuso. IMPATTO: I pattern sono "intrappolati" nel formato Yamaha. Non interoperabili con ecosistema musicale moderno. Limita utilità dello strumento per produzione musicale. FIX: Creare comando `export` che usa libreria `mido` per generare SMF Type 1. Mappare sezioni a tracce MIDI, includere tempo, time signature, program change, note events. Option per sezione singola o tutte. RISULTATO ATTESO: `qymanager export pattern.Q7P -o pattern.mid` crea file MIDI apribile in qualsiasi DAW.
